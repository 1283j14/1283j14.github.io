<!-- FILE: about.html -->
const sec = (performance.now() - startTime)/1000;
timeEl.textContent = sec.toFixed(1);
const minutes = sec/60;
const wpm = minutes>0 ? Math.round((correct/5)/minutes) : 0;
wpmEl.textContent = wpm;
}


function updateStatus(){
typedEl.textContent = idx;
correctEl.textContent = correct;
wrongEl.textContent = wrong;
const pct = target.length ? Math.round((idx/target.length)*100) : 0;
meterBar.style.width = pct + '%';
}


hiddenInput.addEventListener('input', (e)=>{
if(!target) return;
const value = e.target.value;
// compare last character
const last = value[value.length-1];
if(typeof last === 'undefined') return;
const expected = target[idx];
if(last === expected){
correct++; idx++; // mark correct
// mark span
const span = textView.querySelector(`span[data-i='${idx-1}']`);
if(span) span.classList.add('correct');
} else {
wrong++;
// flash the current character
const span = textView.querySelector(`span[data-i='${idx}']`);
if(span){ span.classList.add('wrong'); setTimeout(()=>span.classList.remove('wrong'),200); }
}
// keep only last char in the input so we compare char-by-char
e.target.value = '';
updateStatus();
// complete
if(idx >= target.length){
clearInterval(timerId); timerId = null; updateTimer(); alert('完了！');
}
});


// file load
document.getElementById('loadFileBtn').addEventListener('click',()=>fileInput.click());
fileInput.addEventListener('change', (ev)=>{
const f = ev.target.files[0];
if(!f) return;
const reader = new FileReader();
reader.onload = ()=>{
// assume UTF-8; if Shift_JIS, user should convert
source.value = reader.result;
prepareText(source.value);
};
reader.readAsText(f, 'UTF-8');
});


startBtn.addEventListener('click', ()=>{
// prepare if needed
if(!target || target.length<1) prepareText(source.value);
startGame();
});


resetBtn.addEventListener('click', ()=>{ resetGame(); source.value=''; });


randomBtn.addEventListener('click', ()=>{
// 簡単なサンプル文章（実際は青空文庫の本文を貼ってください）
const sample = '吾輩は猫である。名前はまだ無い。\nどこで生れたかとんと見当がつかぬ。\n何でも薄暗いじめじめした所でニャーニャー泣いていた事だけは記憶している。';
source.value = sample;
prepareText(sample);
});


// initial
resetGame();
</script>
</body>
</html>
